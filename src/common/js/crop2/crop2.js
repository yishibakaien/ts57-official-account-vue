/*eslint-disable*/
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.FileUpload=e():t.FileUpload=e()}(this,function(){return function(t){function e(i){if(o[i])return o[i].exports;var s=o[i]={exports:{},id:i,loaded:!1};return t[i].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var o={};return e.m=t,e.c=o,e.p="/",e(0)}([function(t,e,o){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var s=o(4),r=i(s);e["default"]=r["default"]},function(t,e){"use strict";var o=function(t){return(t||"").replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")},i=function(t,e){if(!t||!e)return!1;if(e.indexOf(" ")!==-1)throw new Error("className should not contain space.");return t.classList?t.classList.contains(e):(" "+t.className+" ").indexOf(" "+e+" ")>-1},s=function(t,e){if(t){for(var o=t.className,s=(e||"").split(" "),r=0,h=s.length;r<h;r++){var c=s[r];c&&(t.classList?t.classList.add(c):i(t,c)||(o+=" "+c))}t.classList||(t.className=o)}},r=function(t,e){if(t&&e){for(var s=e.split(" "),r=" "+t.className+" ",h=0,c=s.length;h<c;h++){var n=s[h];n&&(t.classList?t.classList.remove(n):i(t,n)&&(r=r.replace(" "+n+" "," ")))}t.classList||(t.className=o(r))}},h=function(t,e){return t+":"+e},c=function(){return document.addEventListener?function(t,e,o){t&&e&&o&&t.addEventListener(e,o,!1)}:function(t,e,o){t&&e&&o&&t.attachEvent("on"+e,o)}}(),n=function(){return document.removeEventListener?function(t,e,o){t&&e&&t.removeEventListener(e,o,!1)}:function(t,e,o){t&&e&&t.detachEvent("on"+e,o)}}(),a=function(t,e,o){var i=function s(){o&&o.apply(this,arguments),n(t,e,s)};c(t,e,i)};t.exports={hasClass:i,addClass:s,removeClass:r,addVendor:h,on:c,off:n,once:a}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(1),s={h:200,w:200},r={h:400,w:400},h=100;e["default"]={props:{limit:{type:Number,"default":2048}},data:function(){return{openCrop:!1,image:new Image,imgSrc:null,destImg:null,cropBox:{height:h,width:h,left:0,top:0},selectPic:{marginLeft:0,marginTop:0,top:0,left:0},isMousedown:!1,MoveType:{moveRightBottom:"moveRightBottom",moveRightTop:"moveRightTop",moveLeftBottom:"moveLeftBottom",moveLeftTop:"moveLeftTop",move:"move",current:""},enterPoint:{x:0,y:0},target:null,canvas:{ctx:null}}},mounted:function(){var t=this;(0,i.on)(document,"mouseup",function(){return t.mouseup()}),this.canvas.ctx=this.$refs.canvas.getContext("2d")},computed:{cropBoxStyle:function(){return{height:this.cropBox.height+"px",width:this.cropBox.width+"px",left:this.cropBox.left+"px",top:this.cropBox.top+"px"}},selectPicStyle:function(){return{"margin-top":this.selectPic.marginTop+"px","margin-left":this.selectPic.marginLeft+"px",top:this.selectPic.top+"px",left:this.selectPic.left+"px"}}},methods:{draw:function(){var t=this.generateDrwaImageParam(),e=t.source,o=t.dest,i=this.$refs.img.naturalWidth/this.$refs.img.clientWidth,r=s.h/this.cropBox.height;for(var h in e)e[h]=e[h]*i;for(h in o)o[h]=o[h]*r;this.canvas.ctx.clearRect(0,0,s.w,s.h),this.canvas.ctx.drawImage(this.image,e.x,e.y,e.width,e.height,o.x,o.y,o.width,o.height)},clip:function(){this.destImg=this.$refs.canvas.toDataURL(),this.closeCrop()},openFile:function(){this.openCrop||this.$refs.input.click()},closeCrop:function(){this.openCrop=!1,this.$refs.input.value=""},change:function(){var t=this,e=this.$refs.input.files[0];if(e&&e.size<=1024*this.limit){var o=new FileReader;o.onload=function(){var e=o.result;t.setImageURL(e)},o.readAsDataURL(e),this.openCrop=!0}else alert("图片最大为2M")},setImageURL:function(t){var e=this;this.image.onload=function(){var t=e.image.naturalHeight,o=e.image.naturalWidth;t/o!==e.ratio&&console.log("比例不对啊:"+t/o),e.draw()},this.imgSrc=t,this.image.src=t},generateDrwaImageParam:function(){var t={x:0,y:0,width:0,height:0},e={x:0,y:0,width:s.w,height:s.h},o=this.$refs.img.getBoundingClientRect(),i=this.$refs.cropbox.getBoundingClientRect(),r=i.left-o.left,h=i.right-o.right,c=i.top-o.top,n=i.bottom-o.bottom;return i.top>=o.bottom||i.bottom<=o.top||i.left>=o.right||i.right<=o.left?{source:t,dest:e}:(r<=0?(t.x=0,e.x=-r):(t.x=r,e.x=0),h>=0?r<=0?t.width=o.width:t.width=o.width-r:r<=0?t.width=i.right-o.left+1:t.width=this.cropBox.width,e.width=t.width,c<=0?(t.y=0,e.y=-c):(t.y=c,e.y=0),n>=0?c<=0?t.height=o.height:t.height=o.height-c:c<=0?t.height=i.bottom-o.top+1:t.height=this.cropBox.height,e.height=t.height,{source:t,dest:e})},mousedown:function(t){this.isMousedown=!0,this.enterPoint.x=t.pageX,this.enterPoint.y=t.pageY,this.target=t.target},mouseup:function(t){this.isMousedown&&(this.isMousedown=!1,this.MoveType.current="")},mousemove:function(t){if(this.isMousedown){var e=t.pageX,o=t.pageY,i=e-this.enterPoint.x,s=o-this.enterPoint.y;this.target===this.$refs.rightBottom||this.MoveType.current===this.MoveType.moveRightBottom?(console.log("offsetX, offsetY"),this.moveRightBottom(i,s),this.MoveType.current=this.MoveType.moveRightBottom):this.target===this.$refs.rightTop||this.MoveType.current===this.MoveType.moveRightTop?(this.moveRightTop(i,s),this.MoveType.current=this.MoveType.moveRightTop):this.target===this.$refs.leftTop||this.MoveType.current===this.MoveType.moveLeftTop?(this.moveLeftTop(i,s),this.MoveType.current=this.MoveType.moveLeftTop):this.target===this.$refs.leftBottom||this.MoveType.current===this.MoveType.moveLeftBottom?(this.moveLeftBottom(i,s),this.MoveType.current=this.MoveType.moveLeftBottom):this.target!==this.$refs.cropmask&&this.MoveType.current!==this.MoveType.move||(this.move(i,s),this.MoveType.current=this.MoveType.move),this.enterPoint={x:e,y:o}}},moveRightBottom:function(t,e){console.log(t,e);var o=h,i=r.h,s=this.cropBox.width+t,c=this.cropBox.height+e;s<o||c<o||this.cropBox.left+s>=i||this.cropBox.top+c>=i||(Math.abs(e)>Math.abs(t)?(this.cropBox.width+=e,this.cropBox.height+=e):(this.cropBox.width+=t,this.cropBox.height+=t),this.draw())},moveRightTop:function(t,e){var o=h,i=r.h,s=this.cropBox.width+t,c=this.cropBox.height-e;s<o||c<o||this.cropBox.left+s>=i||this.cropBox.top<=0||(Math.abs(e)>Math.abs(t)?(this.cropBox.width-=e,this.cropBox.height-=e,this.cropBox.top+=e,this.selectPic.top-=e):(this.cropBox.width+=t,this.cropBox.height+=t,this.cropBox.top-=t,this.selectPic.top+=t),this.draw())},moveLeftTop:function(t,e){var o=h,i=this.cropBox.left+t,s=this.cropBox.top+e;i<=0||s<=0||this.cropBox.height-e<=o||this.cropBox.width-t<=o||(Math.abs(e)>Math.abs(t)?(this.cropBox.width-=e,this.cropBox.height-=e,this.cropBox.top+=e,this.cropBox.left+=e,this.selectPic.top-=e,this.selectPic.left-=e):(this.cropBox.width-=t,this.cropBox.height-=t,this.cropBox.top+=t,this.cropBox.left+=t,this.selectPic.top-=t,this.selectPic.left-=t),this.draw())},moveLeftBottom:function(t,e){var o=h,i=this.cropBox.left+t,s=this.cropBox.height+e;i<=0||s+this.cropBox.top>=r.h||this.cropBox.height+e<=o||this.cropBox.width-t<=o||(Math.abs(e)>Math.abs(t)?(this.cropBox.width+=e,this.cropBox.height+=e,this.cropBox.left-=e,this.selectPic.left+=e):(this.cropBox.width-=t,this.cropBox.height-=t,this.cropBox.left+=t,this.selectPic.left-=t),this.draw())},move:function(t,e){var o=this.cropBox.left+t,i=this.cropBox.top+e;o>=0&&i>=0&&o+this.cropBox.width<=r.w&&i+this.cropBox.height<=r.h&&(this.cropBox.left=o,this.cropBox.top=i,this.selectPic.marginLeft-=t,this.selectPic.marginTop-=e),this.draw()}}}},function(t,e){},function(t,e,o){var i,s;o(3),i=o(2);var r=o(5);s=i=i||{},"object"!=typeof i["default"]&&"function"!=typeof i["default"]||(s=i=i["default"]),"function"==typeof s&&(s=s.options),s.render=r.render,s.staticRenderFns=r.staticRenderFns,t.exports=i},function(module,exports){module.exports={render:function(){with(this)return _h("div",{staticClass:"file-upload-container"},[_h("img",{directives:[{name:"show",value:null!==destImg,expression:"destImg !== null"}],staticClass:"dest-image",attrs:{src:destImg},on:{click:openFile}})," ",_h("a",{directives:[{name:"show",value:null===destImg,expression:"destImg === null"}],staticClass:"file-upload-icon"},[_h("input",{directives:[{name:"show",value:!openCrop,expression:"!openCrop"}],ref:"input",attrs:{type:"file",accept:"image/png,image/jpeg,image/gif"},on:{change:change}})])," ",_h("div",{directives:[{name:"show",value:openCrop,expression:"openCrop"}],staticClass:"crop-container"},[_h("div",{staticClass:"crop-container__source",on:{mouseup:mouseup,mousemove:mousemove}},[_h("img",{ref:"img",staticClass:"crop-container__source__image",attrs:{src:imgSrc}})," ",_h("div",{ref:"cropbox",staticClass:"crop-box",style:cropBoxStyle,on:{mousedown:mousedown}},[_m(0)," ",_m(1)," "," ",_h("span",{ref:"borderTop",staticClass:"crop-line-border-top"})," ",_h("span",{ref:"borderRight",staticClass:"crop-line-border-right"})," ",_h("span",{ref:"borderBottom",staticClass:"crop-line-border-bottom"})," ",_h("span",{ref:"borderLeft",staticClass:"crop-line-border-left"})," "," ",_h("span",{ref:"leftTop",staticClass:"crop-corner crop-corner__left-top"})," ",_h("span",{ref:"rightTop",staticClass:"crop-corner crop-corner__right-top"})," ",_h("span",{ref:"rightBottom",staticClass:"crop-corner crop-corner__right-bottom"})," ",_h("span",{ref:"leftBottom",staticClass:"crop-corner crop-corner__left-bottom"})," "," ",_h("div",{staticClass:"crop-inner-container",style:selectPicStyle},[_h("img",{staticClass:"crop-container__source__image",attrs:{src:imgSrc}})])," "," ",_h("div",{ref:"cropmask",staticClass:"crop-box__mask"})])])," ",_h("canvas",{ref:"canvas",staticClass:"crop-canvas",attrs:{width:"200",height:"200"}})," ",_h("div",{staticClass:"crop-btn crop-cancel",on:{click:closeCrop}},["取消"])," ",_h("div",{staticClass:"crop-btn crop-yes",on:{click:clip}},["确定"])])])},staticRenderFns:[function(){with(this)return _h("span",{staticClass:"crop-line-h"})},function(){with(this)return _h("span",{staticClass:"crop-line-v"})}]}}])});
